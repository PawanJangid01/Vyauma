@using Umbraco.Cms.Core.Models.Blocks
@using Umbraco.Cms.Web.Common.PublishedModels;
@using Umbraco.Cms.Core.Models
@using System.Linq
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
	Layout = null;

    var layout = Umbraco.ContentAtRoot()
        .FirstOrDefault(x => x.ContentType.Alias == "masterLayout");


    if (layout == null)
    {
        <text>Master Layout node not found</text>;
    }
    var headerLogo = layout?.Value<MediaWithCrops>("headerLogo");
    var headerIcon = layout?.Value<MediaWithCrops>("headerIcon");
    var headerMenu = layout?.Value<BlockListModel>("headerMenu");
    var faviconIcon = layout?.Value<MediaWithCrops>("faviconIcon");

    // Footer Section
    
     var footerLogo = layout?.Value<MediaWithCrops>("footerLogo");
     var footerDescription = layout?.Value<string>("footerDescription");
     var socialLink = layout?.Value<string>("socialLink");
     var pageLinks = layout?.Value<string>("pageLinks");
     var contactDetails = layout?.Value<string>("contactDetails");
     var policyLink = layout?.Value<string>("policyLink");
     var copyRightText = layout?.Value<string>("copyRightText");

    var currentUrl = Context.Request.Path.Value?.ToLower();

     // Page-level SEO
var seoBlock = Model.Value<BlockListModel>("seoSetting")?
                    .FirstOrDefault()?.Content;
var pageMetaTitle = seoBlock?.Value<string>("metaTitle");
var pageMetaDescription = seoBlock?.Value<string>("metaDescription");
var pageMetaKeywords = seoBlock?.Value<string>("metaKeywords");
var noIndex = seoBlock?.Value<bool>("noIndexNoFollow") ?? false;

      // Final SEO values (Page → Fallback → Hard default)
    var metaTitle =
        !string.IsNullOrWhiteSpace(pageMetaTitle)
        ? pageMetaTitle
        : layout?.Value<string>("defaultMetaTitle") ?? "Vyauma";

    var metaDescription =
        !string.IsNullOrWhiteSpace(pageMetaDescription)
        ? pageMetaDescription
        : layout?.Value<string>("defaultMetaDescription");

    var metaKeywords =
        !string.IsNullOrWhiteSpace(pageMetaKeywords)
        ? pageMetaKeywords
        : layout?.Value<string>("defaultMetaKeywords");

}


<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>@metaTitle</title>
@if (!string.IsNullOrWhiteSpace(metaDescription))
{
    <meta name="description" content="@metaDescription" />
}
@if (!string.IsNullOrWhiteSpace(metaKeywords))
{
    <meta name="keywords" content="@metaKeywords" />
}
@if (noIndex)
{
    <meta name="robots" content="noindex, nofollow" />
}

<link rel="canonical" href="@Model.Url(mode: UrlMode.Absolute)" />

  <!-- Favicons -->
  @if(faviconIcon != null)
  {
  <link href="@faviconIcon.Url()?"  rel="icon">
  }
  @* <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon"> *@

  <!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="~/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="~/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="~/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="~/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="~/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="~/assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Nova
  * Template URL: https://bootstrapmade.com/nova-bootstrap-business-template/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="index-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
        @if(headerLogo != null)
        {
      <a href="/" class="logo d-flex align-items-center">       
        <img src="@headerLogo.Url()" alt="">
      </a>
        }

      <nav id="navmenu" class="navmenu">
        <ul>
        @if (headerMenu != null && headerMenu.Any())
         {   
           @foreach (var menu in headerMenu)
           {
                var content = menu.Content;
                var label = content.Value<string>("label");
                var headMenuLinks = content.Value<IEnumerable<Link>>("link");
                var link = headMenuLinks?.FirstOrDefault();

                 var menuUrl = link.Url?.ToLower();

                 var isActive =
                 menuUrl == currentUrl ||
                 (menuUrl != "/" && currentUrl.StartsWith(menuUrl));  
                 
          <li>
              @if(link != null && label != null)
              {
              <a href="@link.Url" class="@(isActive ? "active" : "")">@label<br></a>
              }
           </li>
           }
         }
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

    <!-- ✅ MAIN CONTENT -->
        <main class="main">
            @RenderBody()
        </main>

  <footer id="footer" class="footer light-background">

    <div class="footer-top">
      <div class="container">
        <div class="row gy-4">
          <div class="col-md-6 col-lg-6 footer-about">
              @if(footerLogo != null)
              {
            <a href="#" class="logo d-flex align-items-center">              
              <img src="@footerLogo.Url()" alt="" >
            </a>
              }
            @Html.Raw(footerDescription.ToString().Replace("<p>", "").Replace("</p>", "")) 
            <div class="social-links d-flex mt-4">
                
            @Html.Raw(socialLink.ToString().Replace("<p>", "").Replace("</p>", "")) 
            </div>
          </div>

          <div class="col-md-6 col-lg-3  footer-links">
           @Html.Raw(pageLinks.ToString().Replace("<p>", "").Replace("</p>", "")) 
          </div>
         

          <div class="col-md-6 col-lg-3  footer-links">
            @Html.Raw(contactDetails.ToString().Replace("<p>", "").Replace("</p>", "")) 
          </div>

        </div>
      </div>
    </div>

    <div class="container copyright text-center">
      <p> @Html.Raw(copyRightText.ToString().Replace("<p>", "").Replace("</p>", "")) </p> 
      <br> 
      <p class="mb-1">
             @Html.Raw(policyLink.ToString().Replace("<p>", "").Replace("</p>", "")) 
       </p>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="~/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="~/assets/vendor/php-email-form/validate.js"></script>
  <script src="~/assets/vendor/aos/aos.js"></script>
  <script src="~/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="~/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="~/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="~/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <script src="~/assets/scripts/main.js"></script>

</body>

</html>